FROM python:3-alpine

ENV LANG en_US.UTF-8
ENV LANGUAGE en_US:en
ENV LC_ALL en_US.UTF-8
ENV TZ Europe/Berlin
ENV CELERYBEAT_SCHEDULE_FILENAME /tmp/celerybeatschedule.db

# prerequirements
RUN apk add --no-cache libgcc libstdc++ binutils gmp isl libgomp libmagic libatomic libgphobos mpfr4 mpc1 gcc nghttp2-libs libcurl pcre2 git libjpeg-turbo pkgconf libjpeg-turbo-dev jpeg-dev linux-headers libffi-dev zlib-dev xz-dev libxml2 libxml2-dev libgpg-error libxslt libxslt-dev musl-dev openssl-dev \
 && pip install dnspython

WORKDIR /opt/superdesk/

# install server
COPY ./server /opt/superdesk
RUN python -m pip install --upgrade pip setuptools wheel
RUN python -m pip install -U -r requirements.txt
RUN apk add --no-cache tzdata \
 && cp /usr/share/zoneinfo/Europe/Berlin /etc/localtime \
 && echo "Europe/Berlin" > /etc/timezone
